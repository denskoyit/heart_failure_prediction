# Прогнозирование хронической сердечной недостаточности на основе модели машинного обучения

Хроническая сердечная недостаточность (ХСН) остается одним из наиболее серьезных и распространенных заболеваний в современном медицинском обществе, создавая значительное бремя для общественного здоровья и систем здравоохранения. В настоящее время данная патология выявляется примерно у 1-2% населения в развитых странах, что подчеркивает необходимость в более эффективных методах диагностики и прогнозирования этого состояния.
В связи с развитием искусственного интеллекта и моделей машинного обучения возникли более эффективные и практичные методы определения заболеваний в области медицины. Машинное обучение представляет собой подраздел ИИ, фокусирующийся на создании систем, которые могут учиться и принимать решения на основе опыта без явного программирования. Методы машинного обучения, такие как алгоритмы классификации и регрессии, могут обрабатывать большие объёмы клинических данных, выделять важные признаки и предсказывать вероятного развития данного заболевания. 

**Целью данного проекта** является разработка и реализация модели машинного обучения для прогнозирования ХСН на ранних стадиях. Это позволит не только существенно улучшить качество жизни пациентов, но и сократить затраты на лечение и обеспечение эффективной медицинской помощи.

**Задачи проекта:**
  1.	Анализ существующих методов диагностики и прогнозирования ХСН.
  2.	Сбор и обработка данных о пациентах с сердечной недостаточностью.
  3.	Разработка и обучение модели машинного обучения на основе собранных данных.
  4.	Оценка эффективности разработанной модели и сравнение её с существующими методами.

**Предмет исследования:** хроническая сердечная недостаточность (ХСН).
**Объект исследования:** клинические данные пациентов из открытой базы данных.
**Методы исследования:** анализ литературы, сбор данных, обработка данных, применение методов машинного обучения, оценка результатов, интерпретация результатов и выводы.

**ТЕОРЕТИЧЕСКИЙ РАЗДЕЛ**
Хроническая сердечная недостаточность (ХСН) — это синдром, сопровождающийся хроническим нарушением миокардиальных сокращений и приводящий к нарушению кровоснабжения тканевых и органных структур. Это наиболее частый диагноз, который ставится пожилым пациентам при обращении к врачу. В Российской Федерации, по данным Российских эпидемиологических исследований, встречаемость ХСН в общей популяции составляет 7%.
Рост заболеваемости ХСН ассоциирован с неуклонно прогрессирующим старением населения, распространённостью факторов риска, снижением смертности от других хронических заболеваний, улучшением показателей выживаемости после острых форм ишемической болезни сердца. ХСН, являясь конечной стадией развития и прогрессирования различных заболеваний ассоциируется с высокой заболеваемостью, заметным ухудшением качества жизни и неблагоприятным прогнозом, высоким риском повторных госпитализаций и смерти. 
Хроническая сердечная недостаточность, как правило, сопровождается недостаточной перфузией органов, а также одышкой слабостью, учащённым сердцебиением, повышенной утомляемостью и задержкой жидкости в организме. 
В нашей стране клинически выраженная сердечная недостаточность I-II функционального класса встречается у 5,1 млн человек, III-IV функционального класса – 2,4 млн человек. В возрасте от 45 до 54 лет СН встречается 0,7%, в возрасте 75 лет – у 8,4% лиц. В европейской части РФ 65,5% больных с ХСН составляют лица в возрасте от 60 до 79 лет. Пожилые больные (в 68,1% случаев) имеют ХСН III-IV ФК среди больных, имеющих данное заболевание.
Следовательно, важным фактором, влияющим на распространённость ХСН, является возраст больных.
Значительная часть госпитализаций больных обусловлена ухудшением течения СН вследствие несоблюдения рекомендаций врача касательно режима, диеты и приёма лекарственных препаратов (от 12 до 64% случаев), сохранения неконтролируемой артериальной гипертензии (44%), нарушений ритма сердца (29%), ишемии миокарда (15%), присоединения лёгочных инфекция (17%), вирусных респираторных заболеваний (25%) и т.д.

Знание основных причин и факторов риска развития ХСН имеет важное значение для разработки мероприятий по её предупреждению и глобального лечения заболевания.
Большими факторами риска, кроме возраста, являются мужской пол, артериальная гипертензия, инфаркт миокарда, клапанные пороки сердца. Не менее значительные факторы риска – употребление алкоголя, хроническая болезнь почек, анемия, малоподвижный образ жизни, низкий социально-экономический статус, психологический стресс, курение и т.д.
При курении продукты горения и другие токсины распространяются по организму всего за 21-23 секунды. В этот же период начинают спазмировать мелкие сосуды. В результате этого некоторые жизненно важные органы не получают необходимое количество кислорода. Ситуацию усугубляют дисфункции дыхательной системы, являющиеся закономерные следствием курения. Из-за постоянного сужения стенки сосудов становятся тонкими и ломкими. В дальнейшем на бляшках может сформироваться тромб, который способен закупорить просвет артерии, что приведёт к инфаркту или инсульту. Кроме того, их сжатие становится причиной гипертонии, поэтому курильщики в повышенной зоне риска развития ХСН.
Для снижения частоты госпитализации больных с ХСН необходимо своевременное выявление сопутствующей патологии и факторов с наиболее значимым воздействием на декомпенсацию заболевания.
Учёные приходят к выводу, что применение искусственного интеллекта достаточно эффективно для выявления сердечной недостаточности. Весной 2023 года исследователи Калифорнийского университета, используя несколько методов машинного обучения, выявили пять подтипов сердечной недостаточности. Они изучили данные более 300 тысяч пациентов с сердечной недостаточностью в Великобритании за последние 20 лет. В результате разработано приложение, которое врачи могли бы использовать для определения подтипа сердечной недостаточности у человека.
Кроме того, израильские исследователи совместно с клиникой Рамбам создали инструмент искусственного интеллекта, который предсказывает сердечную недостаточность с высокой точностью на основе тестов ЭКГ. Новая технология предназначена для страдающих миозитом, который повышает риск СН. Алгоритм успешно предсказал 80% случаев среди выборки пациентов с миозитом. Модель ИИ видит детали, которые врачи обычно не могут обнаружить, и предсказывает, кто подвергается риску сердечной недостаточности. Метод после дополнительных исследований будет внедряться в клиниках для раннего лечения и предотвращения серьёзных заболеваний и смертей.
В Российской Федерации также активно внедряют методы машинного обучения в медицину. В марте 2023 года учёные Самарского университета опубликовали результаты исследования по разработке первого в мире метода выявления ХСН без вмешательства в человеческий организм. Учёные разработали сенсор, позволяющий подтвердить наличие заболевания с использованием ИИ и оптической диагностики. Учёным предстоит усовершенствовать свой метод и провести клинические испытания для повышения точности анализа.
Хроническая сердечная недостаточность представляет серьезную угрозу общественному здоровью. Стремительное развитие методов искусственного интеллекта в медицине открывает новые перспективы для ранней диагностики и эффективного лечения этого синдрома. Использование машинного обучения и инновационных методов диагностики с ИИ может существенно повысить эффективность медицинской практики и улучшить результаты лечения пациентов с ХСН.

**ПРАКТИЧЕСКИЙ РАЗДЕЛ**
В ходе исследования использовался дата-сет (набор данных) с показателями 299 пациентов, составленный Союзный госпиталем г. Фейсабалад (Пакистан) и Фейсабаладского института кардиологии в период с апреля по декабрь 2015 года. Выборка представляет собой 105 женщин и 194 мужчины. Возраст – от 40 до 95 лет. Все 299 пациентов переносили ранее сердечные недостаточности III и IV функциональных классов.
Набор данных содержит 13 характеристик. Некоторые признаки являются бинарными: анемия, гипертония, диабет, пол и курение. Что касается характеристик, креатининфосфокиназа (КФК) определяет уровень фермента КФК в крови. При повреждении мышечной ткани КФК попадает в кровь. Следовательно, высокие уровни КФК в крови пациента могут указывать на сердечную недостаточность или травму. Фракции выброса определяют процентное соотношение количества крови, откачиваемого левым желудочком при каждом сокращении. Креатинин в сыворотке крови – это ненужный продукт, вырабатываемый креатином при разрушении мышцы. Натрий – это минерал, который служит для правильного функционирования мышц и нервов. Аномально низкий уровень натрия в крови может быть вызван сердечной недостаточностью. Также закреплены случаи, когда пациент умирал во время наблюдения (96 человек). [ ]
Исходя из полученных данных, необходимо определить, какие именно факторы влияют на развитие сердечной недостаточности и с какой вероятностью она может развиться у конкретного пациента. Можно выдвинуть следующие гипотезы:
1.	Курильщики больше подвержены заболеваниям сердечной недостаточности.
2.	Мужчины болеют ХСН чаще, чем женщины.
3.	В зоне риска – пожилые люди в возрасте от 65 до 79 лет.
Портрет потенциально госпитализированного пациента: пожилой курящий мужчина.
Для реализации проекта я использовал Python – язык программирования, часто используемый для анализа данных, а именно его специализированные библиотеки: Pandas, NumPy, Seaborn, Scikit-learn, Matplotlib и др. Вся техническая работа проводилась непосредственно на базе программного обеспечения Jupyter Notebook.
Работа состояла из двух этапов: изучение данных (понимание, подготовка, анализ и использование данных для обучения модели) и обучение модели (выбор модели, признаков, разделение данных, обучение, тестирование и оценка производительности).
1.	Изучение данных
Для начала я составил таблицу корреляции (рис. 2) – инструмент для определения степени взаимосвязи между двумя переменными – и сделал следующие выводы:
1. Фактор «time» (период наблюдения) является самым важным и имеет обратную зависимость от других факторов, поскольку очень важно как можно раньше диагностировать заболевание, чтобы получить своевременное лечение, тем самым снижая вероятность смертельного исхода.
2. Фактор «serum_creatinine» (уровень креатинина в сыворотке крови) не менее важен (корреляция со смертельным исходом 0.29), так как нормальное содержание креатинина облегчает работу сердца.
3. Фактор «ejection_fraction» (фракции выброса) также оказывает значительное влияние на целевую переменную, потому что с фракциями выброса связана эффективность работы сердца.
4. Также можно заметить очевидный факт: с возрастом работа сердца ухудшается.
После применения такого инструмента, как таблица корреляции, легче исключить маловажные факторы и создать эффективную модель.
![image](https://github.com/denskoyit/heart_failure_prediction/assets/96660897/ceb9d749-cccb-4a5e-a8a9-2700f77a8260)
Для визуализации данных следует использовать встроенные графики библиотеки Seaborn. Построив для большинства факторов подобные графики (см. Приложение 1) и проверив их на выбросы, можно заметить, что практически все факторы имеют выбросы, поэтому, учитывая размер набора данных и его релевантность, не следует исключать такие выбросы при предварительной обработке данных, чтобы не совершить какую-либо статистическую ошибку.
После этого не менее важно рассмотреть распределение численных факторов и детальнее изучить их влияние на выживаемость. Для этого использовались столбчатые и скрипичные диаграммы. Принцип работы скрипичных графиков заключается в том, что более широкие участки графика скрипки представляют более высокую вероятность заданного значение, более тонкие – меньшую вероятность. (см. Приложение 2)
Затем я более подробно изучил распределение бинарных факторов, таких, как пол, наличие диабета, анемии, гипертонии и курение. Информация визуализирована в качестве круговых диаграмм (см. Приложение 3)
После завершения визуализации данных необходимо подвести итоги, а также доказать или опровергнуть поставленные ранее гипотезы:
Гипотеза 1. Курильщики больше подвержены заболеваниям сердечной недостаточности. – НЕДОСТАТОЧНО ИНФОРМАЦИИ. В наборе входных данных 67,9% некурящих пациентов (из которых 45,8% выжило и 22,1% умерло) и 32,1% курящих (из которых 22,1% выжило и 10% умерло). Исходная информация не даёт достаточного понимания о влиянии курения. Касаемо смертности, то после дополнительных расчётов мы понимаем, что процентное отношение умерших и курящих, а также умерших и некурящих практически одинаковое (в первом случае 32,5%, во втором – 31,1%). Можно сделать вывод, что, основываясь непосредственно на этом наборе данных, курение не является доминирующим факторов в развитии заболевания, но так или иначе оказывает пагубное влияние.
Гипотеза 2. Мужчины болеют ХСН чаще, чем женщины. – ПОДТВЕРЖДЕНА. В наборе данных 64,9% мужчин и 35,1% женщин. Можно сделать вывод, что мужчины чаще женщин жалуются на сердечные заболевания подобного характера. Из них в период наблюдения умерло 20,7% мужчин и 11,4% женщин. Исходя из полученных результатов, мы убеждаемся в правоте данной гипотезы.
Гипотеза 3. В зоне риска – пожилые люди в возрасте от 65 до 79 лет. – ПОДТВЕРЖДЕНА. В диаграмме распределения по возрасту разброс достаточно высокий (от 40 до 95 лет). Больше всего пациентов обнаружено в возрасте 60-61 (39 человек), затем чуть помоложе – 50-51 (31 человек), а за ними – 64-65 (29 человек). Что касаемо диапазона от 65 до 79 лет, то это 93 человека (т. е. 31% от общего числа пациентов), однако больше всего пациентов можно наблюдать в возрасте от 50 до 64 лет – 134 человека (45% от общего числа пациентов). Данный факт говорит о том, что заболевания со временем «молодеют», в том числе и проблемы с сердцем. Тем не менее, пожилые люди от 65 до 79 лет действительно находятся в зоне риска, поэтому гипотеза оказалась верна.
После изучения данных и подведения выводов по анализу можно приступать ко второму этапу – моделированию данных и обучению.
2.	Моделированные данных и обучение
Следует помнить, что модель необходимо обучать не на всём наборе данных, поскольку её ещё нужно протестировать. В зависимости от размера данных набор делят на обучающую и тестовую выборки. Если показателей достаточно, то можно выделить место также под валидационную выборку – набор данных, который используется в процессе разработки модели для подбора оптимального набора гиперпараметров (рис 3). Так как в исходном наборе данных всего лишь 299 пациентов, то валидационную выборку использовать не стоит.
![image](https://github.com/denskoyit/heart_failure_prediction/assets/96660897/b2cd290a-30d6-4812-a334-42974b806815)
Очень важно, чтобы данные из обучающей и тестовой выборки не повторялись, иначе можно добиться переобучения модели – успешной работы на заранее известных данных, однако тогда мы не узнаем, как поведёт себя модель на новом датасете. Кроме того, под обучающую выборку необходимо выделять более 70% от общего набора данных. В противном случае нас ждёт недообучение модели – явление, обратное переобучению (рис. 4)
![image](https://github.com/denskoyit/heart_failure_prediction/assets/96660897/690a3281-6cc2-494e-9138-760ad67d450c)
Я решил разделить выборки в самом эффективности соотношении - 80/20.
Для обучения я использовал 9 различных моделей, каждая из которой не может быть предназначена для определённой задачи, поэтому методом многократных проб и исследований можно достичь желаемого результата.
Краткое описание используемых моделей:
1.	Логистическая регрессия (Logistic Regression) - статистическая модель, используемая для прогнозирования вероятности возникновения некоторого события путём его сравнения с логистической кривой.
Пример обучения модели LR:
![image](https://github.com/denskoyit/heart_failure_prediction/assets/96660897/8e863c21-e589-40ad-8e22-af375ddac2a5)
2.	Метод опорных векторов (SVC) - это алгоритм машинного обучения, используемый для решения задач классификации, который строит гиперплоскость в n-мерном пространстве для разделения объектов двух или более классов.
3.	Метод k-ближайших соседей (K-Neighbors Classifier) - метрический алгоритм для автоматической классификации объектов или регрессии.
4.	Дерево решений (Decision Tree Classifier) - это модель машинного обучения, которая представляет собой дерево с узлами и листьями. Узлы дерева представляют собой решения, которые необходимо принимать, а листья — конечные результаты. В задачах классификации каждый лист дерева соответствует определенному классу, а в задачах регрессии — числовому значению.
5.	Случайный лес (Random Forest Classifier) -  это алгоритм машинного обучения, который состоит из множества отдельных независимых «деревьев решений».
6.	Градиентный бустинг (Gradient Boosting Classifier) - метод машинного обучения, который создает решающую модель прогнозирования в виде ансамбля слабых моделей прогнозирования, обычно деревьев решений.
7.	XGBoost Boosting – улучшенная версия градиентного бустинга.
8.	Усиленный световой градиент (LightGBM) – метод количественных взаимосвязей.
9.	CatBoost Classifier – эффективный и скоростной алгоритм, разработанный Яндеком с применением градиентного бустинга и минимизацией переобучения.
В качестве метрики я решил использовать Accuracy – метрику, основанную на матрице ошибок (рис. 5)
![image](https://github.com/denskoyit/heart_failure_prediction/assets/96660897/274ac80c-e8b3-4166-b4e2-f503bb467299)
Результаты точности различных моделей можно увидеть в диаграмме на рис.  6:
![image](https://github.com/denskoyit/heart_failure_prediction/assets/96660897/c502b12b-1728-4843-8bbc-58d3b6014e4d)
Лучше всего с задачей справились именно алгоритмы на основе градиентного бустинга (93.33% верных предсказаний), при этом хуже всего с задачей справился усиленный световой градиент (86.67% верных предсказаний), однако при изменении гиперпараметров (например, максимальной глубины) можно добиться улучшения результата. В общем и целом, модель машинного обучения поставленную цель выполнила.

**ЗАКЛЮЧЕНИЕ**

Выполнение проекта по прогнозированию хронической сердечной недостаточности на основе модели машинного обучения оказалось успешным.
Перед началом работы я изучил достаточное количество литературы о сердечных заболеваниях, а также изучил истории реальных пациентов для того, чтобы разбираться в данной проблеме хотя бы на базовом уровне.
В ходе работы был выполнен подробный анализ данных о пациентах с сердечной недостаточностью, включая различные клинические параметры и факторы риска. Удалось дать комментарии по поводу трёх выдвинутых гипотез, две из которых подтвердились, а третья требует более подробного набора данных. Это даёт возможность развивать проект в долгосрочной перспективе, изучив большее количество данных и собрав свой собственный дата-сет.
Были применены различные модели машинного обучения, такие как алгоритмы классификации, регрессии, а также градиентного бустинга для построения прогностических моделей.
Цели и задачи работы были успешно выполнены.
Результаты работы наглядно показали, что использование моделей машинного обучения позволяет вполне эффективно выявлять пациентов с риском развития сердечной недостаточности на ранних стадиях. Это открывает возможности для принятия своевременных мер по предотвращению и лечению данного заболевания.
Таким образом, этот проект является важным шагом в направлении улучшения качества диагностики и лечения сердечной недостаточности, и его результаты имеют потенциал для практического применения в клинической медицине.

**Список источников:**

1.	Бугаева О. В., Акимова Н. С., Шварц Е. Ю., Соколов И.М. Хроническая сердечная недостаточность: современные представления: учебное пособие. – М.: Изд-во «Академия Естествознания», 2021 – 59 с.
2.	Ларина В.Н. Хроническая сердечная недостаточность в практике врача. Учебное пособие. М.: Издательство РАМН, 2016. 92с.
3.	Сердечная недостаточность. Методическое пособие / Ю. Л. Беграмбекова, Г. А. Кухарчик, Ю. В. Семенова [и др.]. – Москва: ОССН, 2020. – 36 с.
4.	https://lordmed.ru/poleznaya-informatciya/kurenie/kurenie-i-serdechnaya-nedostatochnost/
5.	https://vc.ru/u/1348288-izrail-budushchee-uzhe-nastupilo/567825-izrailskiy-ii-predskazyvaet-serdechnuyu-nedostatochnost-u-pacientov-s-vospaleniem-myshc-s-tochnostyu-80
6.	https://www.rbc.ru/life/news/64c8da489a794758abcb155c
7.	https://bmcmedinformdecismak.biomedcentral.com/articles/10.1186/s12911-020-1023-5#Tab1
8.	https://www.kaggle.com/datasets/andrewmvd/heart-failure-clinical-data






